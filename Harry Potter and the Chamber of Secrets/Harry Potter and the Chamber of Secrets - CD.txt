custom-name: Harry Potter and the Chamber of Secrets - CD
files:
- launcher: https://github.com/legluondunet/MyLittleLutrisScripts/raw/master/Harry%20Potter%20and%20the%20Chamber%20of%20Secrets/HP2GUI_1.3.7z
- dgv: https://github.com/legluondunet/mlls-tools/raw/master/dgVoodoo2/dgVoodoo2_61.zip
- patch: https://github.com/legluondunet/MyLittleLutrisScripts/raw/master/Harry%20Potter%20and%20the%20Chamber%20of%20Secrets/hp2cos_patch.7z
- config: https://github.com/legluondunet/MyLittleLutrisScripts/raw/master/Harry%20Potter%20and%20the%20Chamber%20of%20Secrets/hp2cos_config_files.7z
game:
  exe: drive_c/HP2COS/hp2gui/HP2GUI_1.3.exe
  prefix: $GAMEDIR
install_complete_text: Installation complete! Enjoy!
installer:
- insert-disc:
    requires: Autorun.exe
- task:
    arch: win64
    description: Creating Wine prefix
    install_gecko: false
    install_mono: false
    name: create_prefix
    prefix: $GAMEDIR
- task:
    args: /desktop=HP2COS,1024x780 $DISC/setup/Setup.exe
    description: Installing Harry Potter and the Chamber of Secrets...
    executable: $GAMEDIR/drive_c/windows/explorer.exe
    include_processes: explorer.exe
    name: wineexec
- task:
    app: dotnet40 dotnet48 dotnet_verifier
    description: Installing Dotnet 4.8, could take a long time, 10-20 mn...
    name: winetricks
    prefix: $GAMEDIR
- execute:
    command: cd "$GAMEDIR/drive_c/Program Files (x86)/EA Games"; hp2cos=$(ls |grep
      -i harry); echo $hp2cos; mv "$hp2cos" ../../HP2COS;
- execute:
    command: cd "$GAMEDIR/drive_c/HP2COS/system"; sed -i -e "s/WindowedViewportX.*/WindowedViewportX=1280/g"
      -e "s/WindowedViewportY.*/WindowedViewportY=960/g" -e "s/FullscreenViewportX.*/FullscreenViewportX=1280/g"
      -e "s/FullscreenViewportY.*/FullscreenViewportY=960/g" -e "s/WindowedColorBits.*/WindowedColorBits=32/g"
      -e "s/FullscreenColorBits.*/FullscreenColorBits=32/g" default.ini ;
- extract:
    dst: $GAMEDIR/drive_c/tmp
    src: config
- extract:
    dst: $GAMEDIR/drive_c/HP2COS/system
    file: dgv
- copy:
    dst: $GAMEDIR/drive_c/HP2COS/system
    src: $GAMEDIR/drive_c/HP2COS/system/MS/x86/DDraw.dll
- copy:
    dst: $GAMEDIR/drive_c/HP2COS/system
    src: $GAMEDIR/drive_c/HP2COS/system/MS/x86/D3DImm.dll
- execute:
    command: cd "$GAMEDIR/drive_c/HP2COS/system"; mv dgVoodoo.conf dgVoodoo_original.conf;
- write_config:
    data:
      DirectX:
        ForceVerticalSync: true
        Resolution: max_qhd_isf
        VRAM: 256
        dgVoodooWatermark: false
      General:
        CaptureMouse: false
        FullScreenMode: false
        ScalingMode: stretched_ar
    file: $GAMEDIR/drive_c/HP2COS/system/dgVoodoo.conf
- extract:
    dst: $GAMEDIR/drive_c/HP2COS/hp2gui
    file: launcher
- extract:
    dst: $GAMEDIR/drive_c/HP2COS/system
    file: patch
- write_config:
    data:
      General:
        Version: 1.3
        gamepath: c:\hp2cos\
    file: $GAMEDIR/drive_c/users/$USER/Application Data/HP2GUI/HP2GUI/1.0.0.0/HP2GUI.ini
- task:
    arch: win64
    key: ddraw
    name: set_regedit
    path: HKEY_CURRENT_USER\Software\Wine\DllOverrides\
    prefix: $GAMEDIR
    type: REG_SZ
    value: native,builtin
wine:
  Desktop: true

